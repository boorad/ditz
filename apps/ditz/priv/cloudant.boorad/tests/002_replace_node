{
 test2,
 "cloudant test: replace node",
 config1,
 [
  {setup, setup1},
  % assert membership is in pre-init state (no init or joins yet)
  {{httpclient, get, [2, "_cloudant/membership"]}, equal,
                 "{\"all_nodes\":[\"node2@node2.boorad.local\"],"
                 "\"cluster_nodes\":[]}\n"},

  % initialize cluster
  {{httpclient, post, [1, "_cloudant/membership",
                  "@{{json_dir}}/init1.json"]},
                  equal, "{\"result\":\"ok\",\"error\":null,\"id\":1}\n"},

  % assert membership has been initialized
  {{httpclient, get, [3, "_cloudant/membership"]}, equal,
                 "{\"all_nodes\":["
                 "\"node1@node1.boorad.local\","
                 "\"node2@node2.boorad.local\","
                 "\"node3@node3.boorad.local\""
                 "],"
                 "\"cluster_nodes\":["
                 "\"node1@node1.boorad.local\","
                 "\"node2@node2.boorad.local\","
                 "\"node3@node3.boorad.local\""
                 "]}\n"},

  % node 1 dies :(
  {{cloudant, stop_nodes, [1]}, equal, ok},

  % replace a node in the cluster
  {{httpclient, post, [4, "_cloudant/membership",
                  "@{{json_dir}}/replace1.json"]},
                  equal, "{\"result\":\"ok\",\"error\":null,\"id\":1}\n"},

  {{cloudant, nodeup, [2, 4]}, equal, ok},

  % assert membership has replaced node
  {{httpclient, get, [2, "_cloudant/membership"]}, equal,
                 "{\"all_nodes\":["
                 "\"node2@node2.boorad.local\","
                 "\"node3@node3.boorad.local\","
                 "\"node4@node4.boorad.local\""
                 "],"
                 "\"cluster_nodes\":["
                 "\"node2@node2.boorad.local\","
                 "\"node3@node3.boorad.local\","
                 "\"node4@node4.boorad.local\""
                 "]}\n"},

  {teardown, teardown1}
 ]
}.
