{test1, "cloudant test: start, init cluster, join new node, shut cluster down",
 [
  {config, config1},
  {setup, setup1},

  % assert membership is in pre-init state (no init or joins yet)
  {{httpc, get, [2, "_cloudant/membership"]}, equal,
                 "{\"all_nodes\":[\"node2@node2.boorad.local\"],"
                 "\"cluster_nodes\":[]}\n"},

  % initialize cluster
  {{httpc, post, [1, "_cloudant/membership",
                  "@{{conf_dir}}cloudant/json/init1.json"]},
                  equal, "{\"result\":\"ok\",\"error\":null,\"id\":1}\n"},

  % assert membership has been initialized
  {{httpc, get, [3, "_cloudant/membership"]}, equal,
                 "{\"all_nodes\":["
                 "\"node1@node1.boorad.local\","
                 "\"node2@node2.boorad.local\","
                 "\"node3@node3.boorad.local\""
                 "],"
                 "\"cluster_nodes\":["
                 "\"node1@node1.boorad.local\","
                 "\"node2@node2.boorad.local\","
                 "\"node3@node3.boorad.local\""
                 "]}\n"},

  % join new node to cluster
  {{httpc, post, [4, "_cloudant/membership",
                  "@{{conf_dir}}cloudant/json/join1.json"]},
                  equal, "{\"result\":\"ok\",\"error\":null,\"id\":1}\n"},

  % assert membership has added new node
  {{httpc, get, [2, "_cloudant/membership"]}, equal,
                 "{\"all_nodes\":["
                 "\"node1@node1.boorad.local\","
                 "\"node2@node2.boorad.local\","
                 "\"node3@node3.boorad.local\","
                 "\"node4@node4.boorad.local\""
                 "],"
                 "\"cluster_nodes\":["
                 "\"node1@node1.boorad.local\","
                 "\"node2@node2.boorad.local\","
                 "\"node3@node3.boorad.local\","
                 "\"node4@node4.boorad.local\""
                 "]}\n"},

  {teardown, teardown1}
 ]
}.
